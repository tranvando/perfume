<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{admin/layout/layout :: main-fragment(
                                                ~{:: title},
                                                ~{:: #css-resources},
                                                ~{:: #js-resources},
                                                ~{:: #main-content}
                                               )}">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<th:block id="main-content">
    <main class="app-content">
        <h4 style="margin-top:10px; margin-bottom:10px">Danh sách đơn hàng</h4>
        <div class="row">
            <div class="col-md-12">
                <div class="tile">
                    <div class="tile-body">
                        <div class="row element-button">
                            <div class="col-sm-2">
                                <a class="btn btn-delete btn-sm print-file" type="button" onclick="page(1,1)">Đang xử lý</a>
                            </div>
                            <div class="col-sm-2">
                                <a class="btn btn-delete btn-sm nhap-tu-file" type="button" onclick="page(1,2)">Đang giao </a>
                            </div>
                            <div class="col-sm-2">
                                <a class="btn btn-excel btn-sm" type="button" onclick="page(1,3)">Đã giao</a>
                            </div>
                            <div class="col-sm-2">
                                <a class="btn btn-delete btn-sm pdf-file" type="button" onclick="page(1,4)">Đã hủy</a>
                            </div>

                        </div>
                        <h5 id="title-order">Đơn hàng</h5>
                        <table class="table table-hover table-bordered" id="sampleTable">
                            <thead>
                            <tr>
                                <th>Mã</th>
                                <th>Khách hàng</th>
                                <th>Giá trị</th>
                                <th>Ngày đặt</th>
                                <th>Tình trạng</th>
                                <th>Chức năng</th>
                            </tr>
                            </thead>
                            <tbody id="lst-order">
<!--                            <tr>-->
<!--                                <td>MD0837</td>-->
<!--                                <td>Triệu Thanh Phú</td>-->
<!--                                <td>9.400.000 đ</td>-->
<!--                                <td>10-10-2021</td>-->
<!--                                <td>-->
<!--                                    <select class="" id="" style="width:90px">-->
<!--                                        <option value="1">Đang xử lý</option>-->
<!--                                        <option value="2">Đang giao</option>-->
<!--                                        <option value="3">Đã giao</option>-->
<!--                                        <option value="4">Đã hủy</option>-->
<!--                                    </select>-->
<!--                                </td>-->

<!--                                <td><button class="btn btn-primary btn-sm trash" type="button" title="Xóa"><i class="fas fa-trash-alt"></i> </button>-->
<!--                                    <button class="btn btn-primary btn-sm edit" type="button" title="Sửa"><i class="fa fa-edit"></i></button></td>-->
<!--                            </tr>-->

                            </tbody>
                        </table>
                        <div id="pagination-container"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</th:block>

<th:block id="js-resources">
    <script th:inline="javascript">
        $(document).ready(
            function (){
                page(1,1);

            }
        )

        var checkCurPage=1;
        //load bill
        function page(curPage,status){
            $('#pagination-container').pagination({
                dataSource: function(done) {
                    $.ajax({
                        type: 'GET',
                        contentType : "application/json",
                        url: '/admin/lst_order',
                        data:{
                            status:status,
                        },
                        dataType : 'json',
                        success: function(response) {
                            done(response);
                        }
                    });
                },
                pageSize: 5,
                pageNumber:curPage,
                pageRage:1,
                autoHidePrevious: true,
                autoHideNext: true,
                hideWhenLessThanOnePage:true,
                callback: function(data, pagination) {
                    if(status==1){
                        $('#title-order').text('Đơn hàng đang xử lý');
                    }
                    if(status==2){
                        $('#title-order').text('Đơn hàng đang giao');
                    }
                    if(status==3){
                        $('#title-order').text('Đơn hàng đã giao');
                    }
                    if(status==4){
                        $('#title-order').text('Đơn hàng đã hủy');
                    }
                    var html = loadTable(data,status);
                    $('#lst-order').html(html);
                    checkCurPage=pagination.pageNumber;
                }
            })
        }

        function formatDate(dateTime){
            var date = new Date(dateTime);
            var dateStr =
                ("00" + date.getDate()).slice(-2) + "/" +
                ("00" + (date.getMonth() + 1)).slice(-2) + "/" +
                date.getFullYear() + " " +
                ("00" + date.getHours()).slice(-2) + ":" +
                ("00" + date.getMinutes()).slice(-2) + ":" +
                ("00" + date.getSeconds()).slice(-2);
            return dateStr;
        }

        //for load dữ liệu
        function loadTable(data,status){
            var html = '';
            $.each(data, function(index, item){
               var price=item.totalPrice.toLocaleString({style : 'currency', currency : 'VND'});
                html+=
                    '<tr>'+
                        '<td>'+item.id+'</td>'+
                        '<td>'+item.receiverName+'</td>'+
                        '<td>'+price+'đ</td>'+
                        '<td>'+ formatDate(item.createdDate)+'</td>'+
                        '<td>';
                            if(status==1){
                                html+=
                                    '<select id="" style="width:90px">'+
                                    '<option value="1">Đang xử lý</option>'+
                                    '<option value="2">Đang giao</option>'+
                                    '</select>';
                            }
                            if(status==2){
                                html+=
                                    '<select id="" style="width:90px">'+
                                    '<option value="2">Đang giao</option>'+
                                    '<option value="3">Đã giao</option>'+
                                    '</select>';
                            }
                            if(status==3){
                                html+='Đã giao';

                            }
                            if(status==4){
                                html+='Đã hủy';
                            }
                        html+=
                        '</td>'+
                        '<td>';
                            if(status==1){
                                html+=
                                    '<button class="btn btn-primary btn-sm trash" type="button" title="Hủy"><i class="fas fa-trash-alt"></i></button>';
                            }
                            html+=
                            '<button class="btn btn-primary btn-sm edit" type="button" title="Xem"><i class="fa fa-edit"></i></button>'+
                        '</td>'+
                    '</tr>'
            });
            return html;
        }
    </script>
</th:block>
</body>
</html>